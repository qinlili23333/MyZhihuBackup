由于AnyCast技术的存在，通过ip检测位置是非常不可靠的事情，就比如152.199.39.108，你能检测这个ip的位置吗？香港ping只要3ms，日本东京ping也只要2ms，但从香港ping日本东京肯定不止5ms，事实是这个ip是美国Verizon的亚洲CDN分发ip，在香港和东京甚至新加坡都有节点使用这个ip，光靠这个ip无法区分请求来源于香港节点还是东京节点。所以就算不考虑代理的情况，ip也只是标记用户中比较不可靠的选择之一。不过好在大部分使用AnyCast的服务商为便于排障，会把节点信息放在http头里，例如我所在的区域访问这个ip会在标头里得到Server:ECAcc(hkc/BD50)，那很显然我们就可以知道现在的响应来自香港节点。但每个服务商的标头都不一样，比如cloudflare则是cf-ray，显然适配各个服务商的标头也需要一定的工作量，而且你不能保证所有服务商都这么干。