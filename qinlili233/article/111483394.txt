干掉超星的flash播放器
<p data-pid="lLG-W8Ja">超星部分课程早就可以用h5播放器了,而少部分课程至今还是flash播放器</p><p data-pid="LtBNhlg6">作为一个早就把flash彻底从电脑上删除干净的人,怎么可能把flash装回来呢?</p><p data-pid="0nfEk02B">ok,折腾,走起!</p><p><br></p><p data-pid="IXSK-bPb">这是只能用flash的课程的界面</p><figure data-size="normal"><noscript><img src="https://pica.zhimg.com/v2-944ba3cb4a727a5477633c82c3e4ba65_720w.jpg?source=3af55fa1" data-caption="" data-size="normal" data-rawwidth="1071" data-rawheight="1106" class="origin_image zh-lightbox-thumb" width="1071" data-original="https://pica.zhimg.com/v2-944ba3cb4a727a5477633c82c3e4ba65_r.jpg?source=3af55fa1"></noscript><img src="data:image/svg+xml;utf8,&lt;svg%20xmlns='http://www.w3.org/2000/svg'%20width='1071'%20height='1106'&gt;&lt;/svg&gt;" data-caption="" data-size="normal" data-rawwidth="1071" data-rawheight="1106" class="origin_image zh-lightbox-thumb lazy" width="1071" data-original="https://pica.zhimg.com/v2-944ba3cb4a727a5477633c82c3e4ba65_r.jpg?source=3af55fa1" data-actualsrc="https://pica.zhimg.com/v2-944ba3cb4a727a5477633c82c3e4ba65_720w.jpg?source=3af55fa1"></figure><p data-pid="xpGl99PG">右键,检查</p><p data-pid="yu1pyhvI">找到iframe,发现有一个data,一看就是个json</p><figure data-size="normal"><noscript><img src="https://pic3.zhimg.com/v2-b4160cdf8a2d9f398ee6be25176797ef_720w.jpg?source=3af55fa1" data-caption="" data-size="normal" data-rawwidth="439" data-rawheight="596" class="origin_image zh-lightbox-thumb" width="439" data-original="https://pic1.zhimg.com/v2-b4160cdf8a2d9f398ee6be25176797ef_r.jpg?source=3af55fa1"></noscript><img src="data:image/svg+xml;utf8,&lt;svg%20xmlns='http://www.w3.org/2000/svg'%20width='439'%20height='596'&gt;&lt;/svg&gt;" data-caption="" data-size="normal" data-rawwidth="439" data-rawheight="596" class="origin_image zh-lightbox-thumb lazy" width="439" data-original="https://pic1.zhimg.com/v2-b4160cdf8a2d9f398ee6be25176797ef_r.jpg?source=3af55fa1" data-actualsrc="https://pic3.zhimg.com/v2-b4160cdf8a2d9f398ee6be25176797ef_720w.jpg?source=3af55fa1"></figure><p data-pid="Y2jOSLLu">对比其他可以h5播放器的课程,发现多了一个值为1的danmaku属性</p><p><br></p><p><br></p><p data-pid="u_tV6r3S">为了方便分析,我们把播放器iframe丢到新标签页</p><p data-pid="o0taP6jG"><a href="http://link.zhihu.com/?target=https%3A//mooc1-1.chaoxing.com/ananas/modules/video/index.html%3Fv%3D2019-1113-1705" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">https://</span><span class="visible">mooc1-1.chaoxing.com/an</span><span class="invisible">anas/modules/video/index.html?v=2019-1113-1705</span><span class="ellipsis"></span></a></p><p data-pid="1J1GRSjH">用ctrl+shift+f全局搜索danmaku,发现下面几个值</p><figure data-size="normal"><noscript><img src="https://pic2.zhimg.com/v2-efd5d613c1aae8a4f7cb5787cbe25ff5_720w.jpg?source=3af55fa1" data-caption="" data-size="normal" data-rawwidth="867" data-rawheight="191" class="origin_image zh-lightbox-thumb" width="867" data-original="https://pic1.zhimg.com/v2-efd5d613c1aae8a4f7cb5787cbe25ff5_r.jpg?source=3af55fa1"></noscript><img src="data:image/svg+xml;utf8,&lt;svg%20xmlns='http://www.w3.org/2000/svg'%20width='867'%20height='191'&gt;&lt;/svg&gt;" data-caption="" data-size="normal" data-rawwidth="867" data-rawheight="191" class="origin_image zh-lightbox-thumb lazy" width="867" data-original="https://pic1.zhimg.com/v2-efd5d613c1aae8a4f7cb5787cbe25ff5_r.jpg?source=3af55fa1" data-actualsrc="https://pic2.zhimg.com/v2-efd5d613c1aae8a4f7cb5787cbe25ff5_720w.jpg?source=3af55fa1"></figure><p data-pid="nn0wGLpO">第一个是解析data这个json,不管他</p><p data-pid="2cTUY805">第二个看不懂,不管他</p><p data-pid="LfQDNaIM">第三个看到if,应该就是判断的了,点进去</p><p data-pid="kMvw-fLa">果然就是我们想要的,判断逻辑是danmaku不存在且支持h5且不是搜狗就使用h5播放器</p><figure data-size="normal"><noscript><img src="https://pic1.zhimg.com/v2-6d36e8a7f49628255667798269bf0680_720w.jpg?source=3af55fa1" data-caption="" data-size="normal" data-rawwidth="772" data-rawheight="257" class="origin_image zh-lightbox-thumb" width="772" data-original="https://pic1.zhimg.com/v2-6d36e8a7f49628255667798269bf0680_r.jpg?source=3af55fa1"></noscript><img src="data:image/svg+xml;utf8,&lt;svg%20xmlns='http://www.w3.org/2000/svg'%20width='772'%20height='257'&gt;&lt;/svg&gt;" data-caption="" data-size="normal" data-rawwidth="772" data-rawheight="257" class="origin_image zh-lightbox-thumb lazy" width="772" data-original="https://pic1.zhimg.com/v2-6d36e8a7f49628255667798269bf0680_r.jpg?source=3af55fa1" data-actualsrc="https://pic1.zhimg.com/v2-6d36e8a7f49628255667798269bf0680_720w.jpg?source=3af55fa1"></figure><p data-pid="YAslkyLI">那么解决这个问题的思路就出来了:我们手动把danmaku的值改成0,问题就解决了</p><p><br></p><p data-pid="LiMsmT83">因为data是个json,和chrome的f12水土不服,改完只剩下一个{了,何况不可能每次都手动改.</p><p data-pid="SM8Ni3Jo">所以我们考虑用js实现</p><p><br></p><p data-pid="a1SDL_0V">这一段给了我灵感</p><figure data-size="normal"><noscript><img src="https://pic2.zhimg.com/v2-2f5010525c1be4f2c098823cd8c25305_720w.jpg?source=3af55fa1" data-caption="" data-size="normal" data-rawwidth="777" data-rawheight="491" class="origin_image zh-lightbox-thumb" width="777" data-original="https://pic2.zhimg.com/v2-2f5010525c1be4f2c098823cd8c25305_r.jpg?source=3af55fa1"></noscript><img src="data:image/svg+xml;utf8,&lt;svg%20xmlns='http://www.w3.org/2000/svg'%20width='777'%20height='491'&gt;&lt;/svg&gt;" data-caption="" data-size="normal" data-rawwidth="777" data-rawheight="491" class="origin_image zh-lightbox-thumb lazy" width="777" data-original="https://pic2.zhimg.com/v2-2f5010525c1be4f2c098823cd8c25305_r.jpg?source=3af55fa1" data-actualsrc="https://pic2.zhimg.com/v2-2f5010525c1be4f2c098823cd8c25305_720w.jpg?source=3af55fa1"></figure><p data-pid="BYQ09Ztm">用getAttribute获取data,做个文本替换,再setAttribute写回去就行了</p><p data-pid="qv37JYf0">不难把代码写出来</p><div class="highlight"><pre><code class="language-js"><span></span><span class="nb">window</span><span class="p">.</span><span class="nx">frameElement</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s1">'data'</span><span class="p">,</span><span class="nb">window</span><span class="p">.</span><span class="nx">frameElement</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="s1">'data'</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/"danmaku":1/</span><span class="p">,</span> <span class="s2">"\"danmaku\":0"</span><span class="p">));</span>
</code></pre></div><p data-pid="0Y6-IFj1">丢进油猴子执行,发现手动刷新iframe后确实可以进入h5播放器,但是要手动刷新iframe太麻烦</p><figure data-size="normal"><noscript><img src="https://pic1.zhimg.com/v2-5cbb9b191c392f666227fd1b84adccba_720w.jpg?source=3af55fa1" data-caption="" data-size="normal" data-rawwidth="1061" data-rawheight="999" class="origin_image zh-lightbox-thumb" width="1061" data-original="https://pic3.zhimg.com/v2-5cbb9b191c392f666227fd1b84adccba_r.jpg?source=3af55fa1"></noscript><img src="data:image/svg+xml;utf8,&lt;svg%20xmlns='http://www.w3.org/2000/svg'%20width='1061'%20height='999'&gt;&lt;/svg&gt;" data-caption="" data-size="normal" data-rawwidth="1061" data-rawheight="999" class="origin_image zh-lightbox-thumb lazy" width="1061" data-original="https://pic3.zhimg.com/v2-5cbb9b191c392f666227fd1b84adccba_r.jpg?source=3af55fa1" data-actualsrc="https://pic1.zhimg.com/v2-5cbb9b191c392f666227fd1b84adccba_720w.jpg?source=3af55fa1"></figure><p data-pid="7IZDuFnG">那么我们在iframe加载前执行不就行了吗?</p><p data-pid="e-onFHVE">在油猴子脚本顶部添加//@run-at document-body,再试一次,这下可以一次性进入h5播放器了</p><p><br></p><p><br></p><p><br></p><p><br></p><p><br></p><p data-pid="V7gk150m">这个脚本我已经发布到了GreasyFork,欢迎使用</p><a href="http://link.zhihu.com/?target=https%3A//greasyfork.org/zh-CN/scripts/397455" data-draft-node="block" data-draft-type="link-card" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">https://</span><span class="visible">greasyfork.org/zh-CN/sc</span><span class="invisible">ripts/397455</span><span class="ellipsis"></span></a><p></p><p></p>