解锁中国大学MOOC非全屏下的超高清
<h2>这破平台nt就nt在非全屏下会隐藏超高清选项</h2><h2>行，上JS，干他娘的！</h2><h2>写在前面;</h2><p data-pid="lEUTZUR5">0.这破平台会尝试对抗F12工具栏，会无限召唤带断点的JS调试VM，解决办法如下</p><figure data-size="normal"><noscript><img src="https://pic3.zhimg.com/v2-cf5c912964c9244642a643e8cb52ee53_720w.jpg?source=3af55fa1" data-caption="" data-size="normal" data-rawwidth="409" data-rawheight="105" class="content_image" width="409"></noscript><img src="data:image/svg+xml;utf8,&lt;svg%20xmlns='http://www.w3.org/2000/svg'%20width='409'%20height='105'&gt;&lt;/svg&gt;" data-caption="" data-size="normal" data-rawwidth="409" data-rawheight="105" class="content_image lazy" width="409" data-actualsrc="https://pic3.zhimg.com/v2-cf5c912964c9244642a643e8cb52ee53_720w.jpg?source=3af55fa1"></figure><p data-pid="cWfWG6wC">1.平台会检测dispatch行为并弹提示，所以要避免通过dispatch来实现</p><h2>分析思路：（懒得再去一张张截图了就简单说说吧）</h2><p data-pid="I34Bo6FX">0.通过F12看HTML发现隐藏的超高清的class为item f-dn，而非隐藏状态下为item</p><p data-pid="j8q-7oRj">1.通过抓取视频链接发现该平台对于超高清的视频后缀是shd，全局查找shd，就十几个结果，一个个翻很快找到关键调用</p><figure data-size="normal"><noscript><img src="https://pic3.zhimg.com/v2-fe1565cfcde1f2b99ab261db685637e4_720w.jpg?source=3af55fa1" data-caption="" data-size="normal" data-rawwidth="774" data-rawheight="293" class="origin_image zh-lightbox-thumb" width="774" data-original="https://pic3.zhimg.com/v2-fe1565cfcde1f2b99ab261db685637e4_r.jpg?source=3af55fa1"></noscript><img src="data:image/svg+xml;utf8,&lt;svg%20xmlns='http://www.w3.org/2000/svg'%20width='774'%20height='293'&gt;&lt;/svg&gt;" data-caption="" data-size="normal" data-rawwidth="774" data-rawheight="293" class="origin_image zh-lightbox-thumb lazy" width="774" data-original="https://pic3.zhimg.com/v2-fe1565cfcde1f2b99ab261db685637e4_r.jpg?source=3af55fa1" data-actualsrc="https://pic3.zhimg.com/v2-fe1565cfcde1f2b99ab261db685637e4_720w.jpg?source=3af55fa1"></figure><p data-pid="jThn7j-4">一个显示一个隐藏刚刚好</p><p data-pid="S-PqKZnr">2.找到这个隐藏的函数，里面有一个KEY_VIDEO<i>_</i>U_HD，在JS内查找发现其值为“超高清”三个大字</p><figure data-size="normal"><noscript><img src="https://pic3.zhimg.com/v2-e4a599d6dcf0a1377f9edd727bc5fca4_720w.jpg?source=3af55fa1" data-caption="" data-size="normal" data-rawwidth="771" data-rawheight="213" class="origin_image zh-lightbox-thumb" width="771" data-original="https://pica.zhimg.com/v2-e4a599d6dcf0a1377f9edd727bc5fca4_r.jpg?source=3af55fa1"></noscript><img src="data:image/svg+xml;utf8,&lt;svg%20xmlns='http://www.w3.org/2000/svg'%20width='771'%20height='213'&gt;&lt;/svg&gt;" data-caption="" data-size="normal" data-rawwidth="771" data-rawheight="213" class="origin_image zh-lightbox-thumb lazy" width="771" data-original="https://pica.zhimg.com/v2-e4a599d6dcf0a1377f9edd727bc5fca4_r.jpg?source=3af55fa1" data-actualsrc="https://pic3.zhimg.com/v2-e4a599d6dcf0a1377f9edd727bc5fca4_720w.jpg?source=3af55fa1"></figure><p data-pid="H1S1lggG">这个函数的意义就一下子看懂了，如果在画质选项里找到了“超高清“这个选项就修改它的class来隐藏掉它</p><p data-pid="ZenBwd9j">3.梳理思路，如果找不到”超高清“那么就不会隐藏，尝试把”超高清"替换成“超清”，再次切换全屏，发现没有隐藏</p><p><br></p><p data-pid="1VjW-iiO">那么我们现在就要写一个脚本，把“超高清”替换成“超清”，然后去掉f-dn来显示出来</p><p><br></p><h2>写脚本：</h2><p data-pid="SWhBCC0j">0.通过getElementsByClassName确认就这一个元素叫f-dn，所以获取元素就是</p><div class="highlight"><pre><code class="language-js"><span></span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByClassName</span><span class="p">(</span><span class="s2">"item f-dn"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</code></pre></div><p data-pid="Usefk4pS">1.首先替换文本</p><div class="highlight"><pre><code class="language-js"><span></span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByClassName</span><span class="p">(</span><span class="s2">"item f-dn"</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">innerHTML</span><span class="o">=</span><span class="s2">"超清"</span><span class="p">;</span>
</code></pre></div><p data-pid="2aRngC5R">2.修改class来显示</p><div class="highlight"><pre><code class="language-js"><span></span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByClassName</span><span class="p">(</span><span class="s2">"item f-dn"</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s2">"class"</span><span class="p">,</span><span class="s2">"item"</span><span class="p">);</span>
</code></pre></div><p data-pid="XmaWdJPK"><b>注意2不能放到1前面否则你的class改过后1会找不到对象</b></p><p data-pid="EAUvcQbY">3.发现视频模块是异步加载的，所以第一次尝试可能会失败，要延时后再试一次直到找到</p><p data-pid="Rul89rK1">这个过程不能用setInterval否则操作完了循环还出不去浪费CPU，所以我选择了嵌套循环策略</p><div class="highlight"><pre><code class="language-js"><span></span>    <span class="kd">function</span> <span class="nx">openHD</span><span class="p">(){</span>
        <span class="k">try</span><span class="p">{</span>
            <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByClassName</span><span class="p">(</span><span class="s2">"item f-dn"</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">innerHTML</span><span class="o">=</span><span class="s2">"超清"</span><span class="p">;</span>
            <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByClassName</span><span class="p">(</span><span class="s2">"item f-dn"</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s2">"class"</span><span class="p">,</span><span class="s2">"item"</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span>
            <span class="nx">setTimeout</span><span class="p">(</span><span class="nx">openHD</span><span class="p">,</span><span class="mi">1000</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">};</span>
    <span class="nx">openHD</span><span class="p">();</span>
</code></pre></div><p data-pid="FpBOAKtF">如果找不到，那么抛出error时就延时1秒再找一次，如果找到了，这个嵌套就自己退出了不占用资源了</p><p data-pid="mJqWxHeA">这样的嵌套循环在任何时候注入都可以，所以run-at可以不用设置</p><p><br></p><p data-pid="4bPLlspx">保存到油猴子使用，非全屏下也可以选择超清了</p><figure data-size="normal"><noscript><img src="https://pic3.zhimg.com/v2-44424df2f4ff1bb2b508945873fd23ae_720w.jpg?source=3af55fa1" data-caption="" data-size="normal" data-rawwidth="1376" data-rawheight="1163" class="origin_image zh-lightbox-thumb" width="1376" data-original="https://pic2.zhimg.com/v2-44424df2f4ff1bb2b508945873fd23ae_r.jpg?source=3af55fa1"></noscript><img src="data:image/svg+xml;utf8,&lt;svg%20xmlns='http://www.w3.org/2000/svg'%20width='1376'%20height='1163'&gt;&lt;/svg&gt;" data-caption="" data-size="normal" data-rawwidth="1376" data-rawheight="1163" class="origin_image zh-lightbox-thumb lazy" width="1376" data-original="https://pic2.zhimg.com/v2-44424df2f4ff1bb2b508945873fd23ae_r.jpg?source=3af55fa1" data-actualsrc="https://pic3.zhimg.com/v2-44424df2f4ff1bb2b508945873fd23ae_720w.jpg?source=3af55fa1"></figure><p><br></p><p><br></p><p><br></p><p data-pid="KSw5yhwp">在这里下载脚本<a href="http://link.zhihu.com/?target=https%3A//greasyfork.org/zh-CN/scripts/412896" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">https://</span><span class="visible">greasyfork.org/zh-CN/sc</span><span class="invisible">ripts/412896</span><span class="ellipsis"></span></a></p><p data-pid="ofPN8rxm">开源仓库<a href="http://link.zhihu.com/?target=https%3A//github.com/qinlili23333/UnlockIcourse163SHD" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">https://</span><span class="visible">github.com/qinlili23333</span><span class="invisible">/UnlockIcourse163SHD</span><span class="ellipsis"></span></a></p>