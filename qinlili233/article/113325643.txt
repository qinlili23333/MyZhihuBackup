自写H5播放器代替超星学术的Flash播放器
<p data-pid="MJTrUKWp">超星学术目前仅有Flash播放器,没H5播放器,这次的情况比上次的<a href="https://zhuanlan.zhihu.com/p/111483394" class="internal">超星网课</a>要糟糕点.</p><figure data-size="normal"><noscript><img src="https://pic2.zhimg.com/v2-3d8aeccb79a4aba4ef513aa3adac1fd3_720w.jpg?source=3af55fa1" data-caption="" data-size="normal" data-rawwidth="1884" data-rawheight="850" class="origin_image zh-lightbox-thumb" width="1884" data-original="https://pic1.zhimg.com/v2-3d8aeccb79a4aba4ef513aa3adac1fd3_r.jpg?source=3af55fa1"></noscript><img src="data:image/svg+xml;utf8,&lt;svg%20xmlns='http://www.w3.org/2000/svg'%20width='1884'%20height='850'&gt;&lt;/svg&gt;" data-caption="" data-size="normal" data-rawwidth="1884" data-rawheight="850" class="origin_image zh-lightbox-thumb lazy" width="1884" data-original="https://pic1.zhimg.com/v2-3d8aeccb79a4aba4ef513aa3adac1fd3_r.jpg?source=3af55fa1" data-actualsrc="https://pic2.zhimg.com/v2-3d8aeccb79a4aba4ef513aa3adac1fd3_720w.jpg?source=3af55fa1"></figure><p data-pid="ZxdA-t3Q">装flash那是绝对不可能的,没有H5播放器,咱自己写一个不就完事了吗?</p><p data-pid="d8Wc6U6S">咱先新建一个H5播放器元素,就用原生的video标签就够了</p><p data-pid="zMy0vyrx">   const H5Video = document.createElement('video');</p><p data-pid="K62tp9B7">那么我们怎么获取播放地址呢?</p><figure data-size="normal"><noscript><img src="https://pic1.zhimg.com/v2-ad6c6123e54f18cf9a7c15c97a04e068_720w.jpg?source=3af55fa1" data-caption="" data-size="normal" data-rawwidth="1280" data-rawheight="875" class="origin_image zh-lightbox-thumb" width="1280" data-original="https://pica.zhimg.com/v2-ad6c6123e54f18cf9a7c15c97a04e068_r.jpg?source=3af55fa1"></noscript><img src="data:image/svg+xml;utf8,&lt;svg%20xmlns='http://www.w3.org/2000/svg'%20width='1280'%20height='875'&gt;&lt;/svg&gt;" data-caption="" data-size="normal" data-rawwidth="1280" data-rawheight="875" class="origin_image zh-lightbox-thumb lazy" width="1280" data-original="https://pica.zhimg.com/v2-ad6c6123e54f18cf9a7c15c97a04e068_r.jpg?source=3af55fa1" data-actualsrc="https://pic1.zhimg.com/v2-ad6c6123e54f18cf9a7c15c97a04e068_720w.jpg?source=3af55fa1"></figure><p data-pid="2jurM8Eg">包含播放地址的函数被套住了...不能直接解析这个json获取地址</p><p data-pid="frSbSUvt">好在右下角有个按钮</p><figure data-size="normal"><noscript><img src="https://pic2.zhimg.com/v2-b7ec67c6f0e24eb1de546821381fbc80_720w.jpg?source=3af55fa1" data-caption="" data-size="normal" data-rawwidth="148" data-rawheight="73" class="content_image" width="148"></noscript><img src="data:image/svg+xml;utf8,&lt;svg%20xmlns='http://www.w3.org/2000/svg'%20width='148'%20height='73'&gt;&lt;/svg&gt;" data-caption="" data-size="normal" data-rawwidth="148" data-rawheight="73" class="content_image lazy" width="148" data-actualsrc="https://pic2.zhimg.com/v2-b7ec67c6f0e24eb1de546821381fbc80_720w.jpg?source=3af55fa1"></figure><p data-pid="IElIgmSD">点击试试</p><p data-pid="c2Fce5Z3">得到一个下载地址</p><figure data-size="normal"><noscript><img src="https://pica.zhimg.com/v2-07e712ca10f3e354b8980a96066939af_720w.jpg?source=3af55fa1" data-caption="" data-size="normal" data-rawwidth="861" data-rawheight="344" class="origin_image zh-lightbox-thumb" width="861" data-original="https://pic2.zhimg.com/v2-07e712ca10f3e354b8980a96066939af_r.jpg?source=3af55fa1"></noscript><img src="data:image/svg+xml;utf8,&lt;svg%20xmlns='http://www.w3.org/2000/svg'%20width='861'%20height='344'&gt;&lt;/svg&gt;" data-caption="" data-size="normal" data-rawwidth="861" data-rawheight="344" class="origin_image zh-lightbox-thumb lazy" width="861" data-original="https://pic2.zhimg.com/v2-07e712ca10f3e354b8980a96066939af_r.jpg?source=3af55fa1" data-actualsrc="https://pica.zhimg.com/v2-07e712ca10f3e354b8980a96066939af_720w.jpg?source=3af55fa1"></figure><p data-pid="wL13epFc">右键检查元素</p><figure data-size="normal"><noscript><img src="https://pic1.zhimg.com/v2-37b5e5c4db4969165408988c8c8e4109_720w.jpg?source=3af55fa1" data-caption="" data-size="normal" data-rawwidth="1150" data-rawheight="92" class="origin_image zh-lightbox-thumb" width="1150" data-original="https://pic1.zhimg.com/v2-37b5e5c4db4969165408988c8c8e4109_r.jpg?source=3af55fa1"></noscript><img src="data:image/svg+xml;utf8,&lt;svg%20xmlns='http://www.w3.org/2000/svg'%20width='1150'%20height='92'&gt;&lt;/svg&gt;" data-caption="" data-size="normal" data-rawwidth="1150" data-rawheight="92" class="origin_image zh-lightbox-thumb lazy" width="1150" data-original="https://pic1.zhimg.com/v2-37b5e5c4db4969165408988c8c8e4109_r.jpg?source=3af55fa1" data-actualsrc="https://pic1.zhimg.com/v2-37b5e5c4db4969165408988c8c8e4109_720w.jpg?source=3af55fa1"></figure><p data-pid="1ufvy8vG">那么设置播放地址就很好写出来了</p><p data-pid="oP1XWPvu">    H5Video.src=document.getElementById("downVideo").href;</p><p data-pid="YrTO0sZa">参照原有div信息,照搬class和id,就不用重新设置css布局了</p><figure data-size="normal"><noscript><img src="https://pic2.zhimg.com/v2-3805f12c864ff8986b476602873ddee2_720w.jpg?source=3af55fa1" data-caption="" data-size="normal" data-rawwidth="1220" data-rawheight="56" class="origin_image zh-lightbox-thumb" width="1220" data-original="https://pic2.zhimg.com/v2-3805f12c864ff8986b476602873ddee2_r.jpg?source=3af55fa1"></noscript><img src="data:image/svg+xml;utf8,&lt;svg%20xmlns='http://www.w3.org/2000/svg'%20width='1220'%20height='56'&gt;&lt;/svg&gt;" data-caption="" data-size="normal" data-rawwidth="1220" data-rawheight="56" class="origin_image zh-lightbox-thumb lazy" width="1220" data-original="https://pic2.zhimg.com/v2-3805f12c864ff8986b476602873ddee2_r.jpg?source=3af55fa1" data-actualsrc="https://pic2.zhimg.com/v2-3805f12c864ff8986b476602873ddee2_720w.jpg?source=3af55fa1"></figure><p data-pid="o2y2Givp">    H5Video.className="Video-main fl";</p><p data-pid="tGNiMNTa">    H5Video.id="playerContent";</p><p data-pid="7fLo0fb4">加上预加载,另外懒得写播放控制了所以直接开启浏览器自带的播放器控制</p><p data-pid="UwxG1cHo">    H5Video.preload=true;</p><p data-pid="mt3SHr7P">    H5Video.controls=true;</p><p data-pid="FcKr6F7K">接下来就是把原来的flash给去掉,再把新写出来的播放器塞进去</p><p data-pid="y20em8Bn">    document.getElementsByClassName("Wid1200 Playvideo1200")[0].removeChild(document.getElementById("playerContent"));</p><p data-pid="y2EXt_j9">    document.getElementsByClassName("Wid1200 Playvideo1200")[0].appendChild(H5Video);</p><p><br></p><p data-pid="yBuqaV5D">最终得到代码</p><div class="highlight"><pre><code class="language-text"><span></span>   const H5Video = document.createElement('video');
    H5Video.src=document.getElementById("downVideo").href;
    H5Video.className="Video-main fl";
    H5Video.id="playerContent";
    H5Video.preload=true;
    H5Video.controls=true;
    document.getElementsByClassName("Wid1200 Playvideo1200")[0].removeChild(document.getElementById("playerContent"));
    document.getElementsByClassName("Wid1200 Playvideo1200")[0].appendChild(H5Video);
</code></pre></div><p data-pid="mdGhFM5L">因为视频地址加载并不在网页头部,所以做成油猴脚本之前要加一句</p><div class="highlight"><pre><code class="language-text"><span></span>//@run-at  document-end
</code></pre></div><p><br></p><p data-pid="8wQI3QoH">看下效果</p><figure data-size="normal"><noscript><img src="https://pic2.zhimg.com/v2-8039f1b11685e5057ccb123488745007_720w.jpg?source=3af55fa1" data-caption="" data-size="normal" data-rawwidth="1941" data-rawheight="725" class="origin_image zh-lightbox-thumb" width="1941" data-original="https://pica.zhimg.com/v2-8039f1b11685e5057ccb123488745007_r.jpg?source=3af55fa1"></noscript><img src="data:image/svg+xml;utf8,&lt;svg%20xmlns='http://www.w3.org/2000/svg'%20width='1941'%20height='725'&gt;&lt;/svg&gt;" data-caption="" data-size="normal" data-rawwidth="1941" data-rawheight="725" class="origin_image zh-lightbox-thumb lazy" width="1941" data-original="https://pica.zhimg.com/v2-8039f1b11685e5057ccb123488745007_r.jpg?source=3af55fa1" data-actualsrc="https://pic2.zhimg.com/v2-8039f1b11685e5057ccb123488745007_720w.jpg?source=3af55fa1"></figure><p><br></p><p data-pid="DclEJlan">点击这里,一键安装<a href="http://link.zhihu.com/?target=https%3A//greasyfork.org/zh-CN/scripts/397941" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">https://</span><span class="visible">greasyfork.org/zh-CN/sc</span><span class="invisible">ripts/397941</span><span class="ellipsis"></span></a></p>