手撸一个雨课堂音乐盘
<p data-pid="RqhjfxOx">就简单讲讲思路吧</p><figure data-size="small"><noscript><img src="https://pic2.zhimg.com/v2-bc22519dc598737c49ae677bae5854a5_720w.jpg?source=3af55fa1" data-rawwidth="1080" data-rawheight="2340" data-size="small" class="origin_image zh-lightbox-thumb" width="1080" data-original="https://pic1.zhimg.com/v2-bc22519dc598737c49ae677bae5854a5_r.jpg?source=3af55fa1"></noscript><img src="data:image/svg+xml;utf8,&lt;svg%20xmlns='http://www.w3.org/2000/svg'%20width='1080'%20height='2340'&gt;&lt;/svg&gt;" data-rawwidth="1080" data-rawheight="2340" data-size="small" class="origin_image zh-lightbox-thumb lazy" width="1080" data-original="https://pic1.zhimg.com/v2-bc22519dc598737c49ae677bae5854a5_r.jpg?source=3af55fa1" data-actualsrc="https://pic2.zhimg.com/v2-bc22519dc598737c49ae677bae5854a5_720w.jpg?source=3af55fa1"></figure><p><br></p><p><br></p><p data-pid="maPchHD4">1：雨课堂的json有跨域，怎么放到本地来读取？</p><p data-pid="GBWWWKVO">不能在本地页面上直接xhr，我的选择是借助webview的js和本地交互来解决</p><blockquote data-pid="-VLY-pQ5">javascript:var oReq = new XMLHttpRequest();var musicData = 0;oReq.onload = function (e) {musicData = oReq.response;KiyomiYKT.writeMusicToPref(btoa(encodeURIComponent(musicData.toString())));};oReq.open(\"GET\", \"<a href="http://link.zhihu.com/?target=https%3A//www.yuketang.cn/api/open/yunpan/search-yunpan-context%3Frole%3D2%26file_type%3D2" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">https://www.</span><span class="visible">yuketang.cn/api/open/yu</span><span class="invisible">npan/search-yunpan-context?role=2&amp;file_type=2</span><span class="ellipsis"></span></a>\");oReq.send();</blockquote><p data-pid="Z1t_byZC">向雨课堂所在webview加载js命令，通过js interface召唤java方法KiyomiYKT.writeMusicToPref（KiyomiYKT为本地app注册的js bridge）</p><p data-pid="21l8hNRk">为了避免万恶的引号问题，所以先转换成base64</p><p><br></p><p data-pid="DpQrxd-q">2：本地如何保存歌单？</p><blockquote data-pid="paYQiaNZ">.method public writeMusicToPref(Ljava/lang/String;)V<br>    .registers 14<br>    .annotation runtime Landroid/webkit/JavascriptInterface;<br>    .end annotation<br>    const/4 v3, 0x0<br>    const-string v1, "YKT_Music"<br>    invoke-virtual {p0, v1, v3}, Landroid/content/Context;-&gt;getSharedPreferences(Ljava/lang/String;I)Landroid/content/SharedPreferences;<br>    move-result-object v1<br>    invoke-interface {v1}, Landroid/content/SharedPreferences;-&gt;edit()Landroid/content/SharedPreferences$Editor;<br>    move-result-object v1<br>    const-string v2, "MusicJsonText"<br>    invoke-interface {v1, v2, p1}, Landroid/content/SharedPreferences$Editor;-&gt;putString(Ljava/lang/String;Ljava/lang/String;)Landroid/content/SharedPreferences$Editor;<br>    move-result-object v0<br>    invoke-interface {v0}, Landroid/content/SharedPreferences$Editor;-&gt;apply()V<br>    const/4 v1, 0x0<br>    const-string p1, "保存雨课堂歌单成功！"<br>    invoke-static {p0, p1, v1}, Landroid/widget/Toast;-&gt;makeText(Landroid/content/Context;Ljava/lang/CharSequence;I)Landroid/widget/Toast;<br>    move-result-object v0<br>    invoke-virtual {v0}, Landroid/widget/Toast;-&gt;show()V<br>    return-void<br>.end method</blockquote><p data-pid="ctaRMn3O">用shared_pref把base64化的json保存起来就行了，比用cookie/localstorage都方便</p><p><br></p><p data-pid="03NakOTA">3：本地页面如何读取歌单？</p><p data-pid="SkJEdmsR">本地页面调用KiyomiYKT.readMusicFromPref();</p><p data-pid="MWgCp5ZS">对应的java方法把base64后的json作为参数回调用js方法</p><blockquote data-pid="Z63eSCiP">    iget-object v3, p0, Lqinlili/Saya_YKT/Saya$GetMusic;-&gt;a:Landroid/webkit/WebView;<br>    iget-object p0, p0, Lqinlili/Saya_YKT/Saya$GetMusic;-&gt;b:Lqinlili/Saya_YKT/Saya;<br>    const/4 v4, 0x0<br>    const-string v0, "YKT_Music"<br>    invoke-virtual {p0, v0, v4}, Landroid/content/Context;-&gt;getSharedPreferences(Ljava/lang/String;I)Landroid/content/SharedPreferences;<br>    move-result-object v0<br>    const-string v1, "MusicJsonText"<br>    invoke-interface {v0, v1, v4}, Landroid/content/SharedPreferences;-&gt;getString(Ljava/lang/String;Ljava/lang/String;)Ljava/lang/String;<br>    move-result-object v1<br>    new-instance v0, Ljava/lang/StringBuilder;<br>    invoke-direct {v0}, Ljava/lang/StringBuilder;-&gt;&lt;init&gt;()V<br>    const-string v2, "javascript:loadMusicJson(\""<br>    invoke-virtual {v0, v2}, Ljava/lang/StringBuilder;-&gt;append(Ljava/lang/String;)Ljava/lang/StringBuilder;<br>    move-result-object v0<br>    invoke-virtual {v0, v1}, Ljava/lang/StringBuilder;-&gt;append(Ljava/lang/String;)Ljava/lang/StringBuilder;<br>    move-result-object v0<br>    const-string v2, "\");"<br>    invoke-virtual {v0, v2}, Ljava/lang/StringBuilder;-&gt;append(Ljava/lang/String;)Ljava/lang/StringBuilder;<br>    move-result-object v0<br>    invoke-virtual {v0}, Ljava/lang/StringBuilder;-&gt;toString()Ljava/lang/String;<br>    move-result-object v1<br>    invoke-virtual {v3, v1}, Landroid/webkit/WebView;-&gt;loadUrl(Ljava/lang/String;)V<br>    return-void</blockquote><p><br></p><p data-pid="RvzV6IY1">本地页面再解析这个json就行了</p><blockquote data-pid="KxZSN0MV">        var loadMusicJson = function (musicJson) {<br>            document.getElementById('xhrempty').innerHTML = "";<br>                    jsonText = JSON.parse(decodeURIComponent(atob(musicJson)));<br>                    var eleNum = 1;<br>                    for (i = 0; i &lt; jsonText.data.results.length; i++) {<br>                        const ele = document.createElement('div');<br>                        ele.className = 'column';<br>                        ele.setAttribute('onclick', "document.getElementById('player').src= '" + jsonText.data.results[i].file_value + "';return false");<br>                        var h = document.createElement("H4");<br>                        var t = document.createTextNode(jsonText.data.results[i].name);<br>                        h.appendChild(t);<br>                        ele.appendChild(h);<br>                        ele.style.backgroundColor = getRandomColor();<br>                       <br>                        document.getElementById("xhrempty").appendChild(ele);<br>                        <br>                    }<br>        };</blockquote><p></p>