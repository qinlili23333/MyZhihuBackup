360加固疑似记录位置信息
<p data-pid="bYkIPEYM">这几天学校要求用pu做个活动，pu这个睿智软件有360加固，于是决定脱壳，在修补dex时意外发现360加固壳体有可疑代码</p><p data-pid="docrKhis">所以，今天的任务是：用证据锤一把360加固</p><p><br></p><p data-pid="qgV8KH3o">分析了大量样本后，琴梨梨发现360加固夹带私货位于各种定位sdk里，为了方便，我们这次选取的是百度定位sdk的demo，各位可以在百度开发者网站下载（当然百度定位本身也不是什么好东西，后台偷偷高精度定位，只是今天百度的流氓行为恰恰可以帮助我们锤360）</p><p data-pid="gcV0-vUj">demo下载<a href="http://link.zhihu.com/?target=http%3A//lbsyun.baidu.com/index.php%3Ftitle%3Dsdk/download%26action%23selected%3Dlocation_all" class=" wrap external" target="_blank" rel="nofollow noreferrer">SDK下载 - 百度LBS开放平台</a></p><figure data-size="normal"><noscript><img src="https://pic1.zhimg.com/v2-2f00e03e8a9f9df3d7ccd7e73fb119dc_720w.jpg?source=3af55fa1" data-caption="" data-size="normal" data-rawwidth="1080" data-rawheight="928" class="origin_image zh-lightbox-thumb" width="1080" data-original="https://pic1.zhimg.com/v2-2f00e03e8a9f9df3d7ccd7e73fb119dc_r.jpg?source=3af55fa1"></noscript><img src="data:image/svg+xml;utf8,&lt;svg%20xmlns='http://www.w3.org/2000/svg'%20width='1080'%20height='928'&gt;&lt;/svg&gt;" data-caption="" data-size="normal" data-rawwidth="1080" data-rawheight="928" class="origin_image zh-lightbox-thumb lazy" width="1080" data-original="https://pic1.zhimg.com/v2-2f00e03e8a9f9df3d7ccd7e73fb119dc_r.jpg?source=3af55fa1" data-actualsrc="https://pic1.zhimg.com/v2-2f00e03e8a9f9df3d7ccd7e73fb119dc_720w.jpg?source=3af55fa1"></figure><p data-pid="ECjJRDKC">这就是咱们要的demo</p><figure data-size="normal"><noscript><img src="https://pica.zhimg.com/v2-2843a297ad8f54f610363e47af4cd0c9_720w.jpg?source=3af55fa1" data-caption="" data-size="normal" data-rawwidth="809" data-rawheight="651" class="origin_image zh-lightbox-thumb" width="809" data-original="https://pic1.zhimg.com/v2-2843a297ad8f54f610363e47af4cd0c9_r.jpg?source=3af55fa1"></noscript><img src="data:image/svg+xml;utf8,&lt;svg%20xmlns='http://www.w3.org/2000/svg'%20width='809'%20height='651'&gt;&lt;/svg&gt;" data-caption="" data-size="normal" data-rawwidth="809" data-rawheight="651" class="origin_image zh-lightbox-thumb lazy" width="809" data-original="https://pic1.zhimg.com/v2-2843a297ad8f54f610363e47af4cd0c9_r.jpg?source=3af55fa1" data-actualsrc="https://pica.zhimg.com/v2-2843a297ad8f54f610363e47af4cd0c9_720w.jpg?source=3af55fa1"></figure><p data-pid="getqjDb9">安装打开先看看</p><figure data-size="normal"><noscript><img src="https://pic1.zhimg.com/v2-91a0bc306d01a669766dbc4fb2fd159e_720w.jpg?source=3af55fa1" data-caption="" data-size="normal" data-rawwidth="1080" data-rawheight="2340" class="origin_image zh-lightbox-thumb" width="1080" data-original="https://pic1.zhimg.com/v2-91a0bc306d01a669766dbc4fb2fd159e_r.jpg?source=3af55fa1"></noscript><img src="data:image/svg+xml;utf8,&lt;svg%20xmlns='http://www.w3.org/2000/svg'%20width='1080'%20height='2340'&gt;&lt;/svg&gt;" data-caption="" data-size="normal" data-rawwidth="1080" data-rawheight="2340" class="origin_image zh-lightbox-thumb lazy" width="1080" data-original="https://pic1.zhimg.com/v2-91a0bc306d01a669766dbc4fb2fd159e_r.jpg?source=3af55fa1" data-actualsrc="https://pic1.zhimg.com/v2-91a0bc306d01a669766dbc4fb2fd159e_720w.jpg?source=3af55fa1"></figure><p data-pid="UjwLariz">ok，莫得问题</p><p data-pid="LudE9VUs">上传到360加固并下载加固包</p><figure data-size="normal"><noscript><img src="https://pic3.zhimg.com/v2-621ee546e66e708a4392e40a6ba01060_720w.jpg?source=3af55fa1" data-caption="" data-size="normal" data-rawwidth="1080" data-rawheight="2340" class="origin_image zh-lightbox-thumb" width="1080" data-original="https://pic1.zhimg.com/v2-621ee546e66e708a4392e40a6ba01060_r.jpg?source=3af55fa1"></noscript><img src="data:image/svg+xml;utf8,&lt;svg%20xmlns='http://www.w3.org/2000/svg'%20width='1080'%20height='2340'&gt;&lt;/svg&gt;" data-caption="" data-size="normal" data-rawwidth="1080" data-rawheight="2340" class="origin_image zh-lightbox-thumb lazy" width="1080" data-original="https://pic1.zhimg.com/v2-621ee546e66e708a4392e40a6ba01060_r.jpg?source=3af55fa1" data-actualsrc="https://pic3.zhimg.com/v2-621ee546e66e708a4392e40a6ba01060_720w.jpg?source=3af55fa1"></figure><p data-pid="IRCW8-c5">这里就是加固包了，记得签个名</p><figure data-size="normal"><noscript><img src="https://pic2.zhimg.com/v2-28ee415c8dfa46b997d9ff8da1211729_720w.jpg?source=3af55fa1" data-caption="" data-size="normal" data-rawwidth="803" data-rawheight="647" class="origin_image zh-lightbox-thumb" width="803" data-original="https://pica.zhimg.com/v2-28ee415c8dfa46b997d9ff8da1211729_r.jpg?source=3af55fa1"></noscript><img src="data:image/svg+xml;utf8,&lt;svg%20xmlns='http://www.w3.org/2000/svg'%20width='803'%20height='647'&gt;&lt;/svg&gt;" data-caption="" data-size="normal" data-rawwidth="803" data-rawheight="647" class="origin_image zh-lightbox-thumb lazy" width="803" data-original="https://pica.zhimg.com/v2-28ee415c8dfa46b997d9ff8da1211729_r.jpg?source=3af55fa1" data-actualsrc="https://pic2.zhimg.com/v2-28ee415c8dfa46b997d9ff8da1211729_720w.jpg?source=3af55fa1"></figure><p data-pid="xQNosD1J">接下来我们对这个加固后的app脱壳</p><p data-pid="vdwYnugQ">启动vmos</p><figure data-size="normal"><noscript><img src="https://pic3.zhimg.com/v2-b137b1f2968d8a38d0dce4e805eec1e8_720w.jpg?source=3af55fa1" data-caption="" data-size="normal" data-rawwidth="1080" data-rawheight="2340" class="origin_image zh-lightbox-thumb" width="1080" data-original="https://pic2.zhimg.com/v2-b137b1f2968d8a38d0dce4e805eec1e8_r.jpg?source=3af55fa1"></noscript><img src="data:image/svg+xml;utf8,&lt;svg%20xmlns='http://www.w3.org/2000/svg'%20width='1080'%20height='2340'&gt;&lt;/svg&gt;" data-caption="" data-size="normal" data-rawwidth="1080" data-rawheight="2340" class="origin_image zh-lightbox-thumb lazy" width="1080" data-original="https://pic2.zhimg.com/v2-b137b1f2968d8a38d0dce4e805eec1e8_r.jpg?source=3af55fa1" data-actualsrc="https://pic3.zhimg.com/v2-b137b1f2968d8a38d0dce4e805eec1e8_720w.jpg?source=3af55fa1"></figure><p data-pid="t2w0Ynho">为了杜绝脱壳机夹带私货，我们今天使用vmos+xposed环境，使用开源脱壳机dumpdex</p><p data-pid="raQnTYvn">dumpdex在github的开源仓库：<a href="http://link.zhihu.com/?target=https%3A//github.com/WrBug/dumpDex" class=" wrap external" target="_blank" rel="nofollow noreferrer">WrBug/dumpDex</a></p><figure data-size="normal"><noscript><img src="https://pic1.zhimg.com/v2-6cb26cbd4cd49e650e285178dfb252dc_720w.jpg?source=3af55fa1" data-caption="" data-size="normal" data-rawwidth="1080" data-rawheight="599" class="origin_image zh-lightbox-thumb" width="1080" data-original="https://pic1.zhimg.com/v2-6cb26cbd4cd49e650e285178dfb252dc_r.jpg?source=3af55fa1"></noscript><img src="data:image/svg+xml;utf8,&lt;svg%20xmlns='http://www.w3.org/2000/svg'%20width='1080'%20height='599'&gt;&lt;/svg&gt;" data-caption="" data-size="normal" data-rawwidth="1080" data-rawheight="599" class="origin_image zh-lightbox-thumb lazy" width="1080" data-original="https://pic1.zhimg.com/v2-6cb26cbd4cd49e650e285178dfb252dc_r.jpg?source=3af55fa1" data-actualsrc="https://pic1.zhimg.com/v2-6cb26cbd4cd49e650e285178dfb252dc_720w.jpg?source=3af55fa1"></figure><p data-pid="VlYw25fa">搭建好脱壳环境，导入加固后的包，运行</p><figure data-size="normal"><noscript><img src="https://pic3.zhimg.com/v2-341f9b8e11e079ca6bf45f0dd66d551a_720w.jpg?source=3af55fa1" data-caption="" data-size="normal" data-rawwidth="1080" data-rawheight="2340" class="origin_image zh-lightbox-thumb" width="1080" data-original="https://pic1.zhimg.com/v2-341f9b8e11e079ca6bf45f0dd66d551a_r.jpg?source=3af55fa1"></noscript><img src="data:image/svg+xml;utf8,&lt;svg%20xmlns='http://www.w3.org/2000/svg'%20width='1080'%20height='2340'&gt;&lt;/svg&gt;" data-caption="" data-size="normal" data-rawwidth="1080" data-rawheight="2340" class="origin_image zh-lightbox-thumb lazy" width="1080" data-original="https://pic1.zhimg.com/v2-341f9b8e11e079ca6bf45f0dd66d551a_r.jpg?source=3af55fa1" data-actualsrc="https://pic3.zhimg.com/v2-341f9b8e11e079ca6bf45f0dd66d551a_720w.jpg?source=3af55fa1"></figure><p data-pid="zZf5YviJ">去dump目录下收割dex</p><figure data-size="normal"><noscript><img src="https://pic2.zhimg.com/v2-9f74a72f749fe24d0613b7d1d0bc73ca_720w.jpg?source=3af55fa1" data-caption="" data-size="normal" data-rawwidth="525" data-rawheight="687" class="origin_image zh-lightbox-thumb" width="525" data-original="https://pic1.zhimg.com/v2-9f74a72f749fe24d0613b7d1d0bc73ca_r.jpg?source=3af55fa1"></noscript><img src="data:image/svg+xml;utf8,&lt;svg%20xmlns='http://www.w3.org/2000/svg'%20width='525'%20height='687'&gt;&lt;/svg&gt;" data-caption="" data-size="normal" data-rawwidth="525" data-rawheight="687" class="origin_image zh-lightbox-thumb lazy" width="525" data-original="https://pic1.zhimg.com/v2-9f74a72f749fe24d0613b7d1d0bc73ca_r.jpg?source=3af55fa1" data-actualsrc="https://pic2.zhimg.com/v2-9f74a72f749fe24d0613b7d1d0bc73ca_720w.jpg?source=3af55fa1"></figure><p data-pid="gu7gCcmy">经过内容排查和大小排查，1.02M的就是脱壳成果</p><p data-pid="8OvQ0q10">打开搜索壳体寻找壳体引用</p><figure data-size="normal"><noscript><img src="https://pic2.zhimg.com/v2-b0efb52f9ae26ef7e0f629efd83c44b2_720w.jpg?source=3af55fa1" data-caption="" data-size="normal" data-rawwidth="1080" data-rawheight="2340" class="origin_image zh-lightbox-thumb" width="1080" data-original="https://pic1.zhimg.com/v2-b0efb52f9ae26ef7e0f629efd83c44b2_r.jpg?source=3af55fa1"></noscript><img src="data:image/svg+xml;utf8,&lt;svg%20xmlns='http://www.w3.org/2000/svg'%20width='1080'%20height='2340'&gt;&lt;/svg&gt;" data-caption="" data-size="normal" data-rawwidth="1080" data-rawheight="2340" class="origin_image zh-lightbox-thumb lazy" width="1080" data-original="https://pic1.zhimg.com/v2-b0efb52f9ae26ef7e0f629efd83c44b2_r.jpg?source=3af55fa1" data-actualsrc="https://pic2.zhimg.com/v2-b0efb52f9ae26ef7e0f629efd83c44b2_720w.jpg?source=3af55fa1"></figure><p data-pid="y01bGodd">壳体里有三类引用</p><p data-pid="NaHdBeUN">第一类是获取真实application，正常壳体操作，加固肯定要置换application，这个类去掉后壳会崩掉</p><p data-pid="GIpY7fjq">第二类是activity的标记，这个方法去除后不影响运行，说明不是壳体关键方法</p><p data-pid="CDChb-cs">第三类就是位置标记，输入变量包括位置，却没有输出变量，这一类就是我认为可疑的地方</p><p><br></p><p data-pid="6XxrzZia">为了避免是修改原指令达成同样目的，我们需要对比原始dex</p><p data-pid="W_bgAGmm">选取同一个类对比</p><figure data-size="normal"><noscript><img src="https://pica.zhimg.com/v2-d795498c03c7f65b330ad75d00a7592d_720w.jpg?source=3af55fa1" data-caption="" data-size="normal" data-rawwidth="1080" data-rawheight="2340" class="origin_image zh-lightbox-thumb" width="1080" data-original="https://pic3.zhimg.com/v2-d795498c03c7f65b330ad75d00a7592d_r.jpg?source=3af55fa1"></noscript><img src="data:image/svg+xml;utf8,&lt;svg%20xmlns='http://www.w3.org/2000/svg'%20width='1080'%20height='2340'&gt;&lt;/svg&gt;" data-caption="" data-size="normal" data-rawwidth="1080" data-rawheight="2340" class="origin_image zh-lightbox-thumb lazy" width="1080" data-original="https://pic3.zhimg.com/v2-d795498c03c7f65b330ad75d00a7592d_r.jpg?source=3af55fa1" data-actualsrc="https://pica.zhimg.com/v2-d795498c03c7f65b330ad75d00a7592d_720w.jpg?source=3af55fa1"></figure><figure data-size="normal"><noscript><img src="https://pic3.zhimg.com/v2-0be2bbb5b64e0cf264992d96d11c7355_720w.jpg?source=3af55fa1" data-caption="" data-size="normal" data-rawwidth="1080" data-rawheight="2340" class="origin_image zh-lightbox-thumb" width="1080" data-original="https://pic1.zhimg.com/v2-0be2bbb5b64e0cf264992d96d11c7355_r.jpg?source=3af55fa1"></noscript><img src="data:image/svg+xml;utf8,&lt;svg%20xmlns='http://www.w3.org/2000/svg'%20width='1080'%20height='2340'&gt;&lt;/svg&gt;" data-caption="" data-size="normal" data-rawwidth="1080" data-rawheight="2340" class="origin_image zh-lightbox-thumb lazy" width="1080" data-original="https://pic1.zhimg.com/v2-0be2bbb5b64e0cf264992d96d11c7355_r.jpg?source=3af55fa1" data-actualsrc="https://pic3.zhimg.com/v2-0be2bbb5b64e0cf264992d96d11c7355_720w.jpg?source=3af55fa1"></figure><p data-pid="1QlIqxnb">现在我们可以确定是360加固主动添加了这一条指令，而不是替换原有指令</p><p><br></p><p data-pid="epCcuKzt">mark，顾名思义就是标记的意思</p><p data-pid="ExezdmYG">而这个指令调用的方法输入就一个位置，还没有输出</p><p data-pid="KG3DozPo">所以很显然它只能是标记了位置</p><p><br></p><p data-pid="dMNTCfZT">我不知道360标记了位置之后拿着位置干什么去了干的是是好事还是坏事，但是，光凭标记位置这一点，这已经不是一个加固服务应该有的了</p><p data-pid="qa8nwv6u">我分析过360，梆梆，爱加密，几维，阿里加固，腾讯加固甚至一些大佬自己写的强壳，只有360一个，有这样的可疑代码</p><p data-pid="ZqMH-HqG">我不敢下定论，但是在有人进一步确认之前，我不建议开发者继续使用360加固</p><p></p><p></p>