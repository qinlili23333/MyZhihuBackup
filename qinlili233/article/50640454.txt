让ps touch兼容9.0
<p data-pid="rgjezdRX">升到9.0几天，没遇到什么兼容性问题，除了miui计算器有一个不合规api调用，改了一下就好了，结果偶然打开ps touch，却发现打不开了</p><figure data-size="normal"><noscript><img src="https://pic2.zhimg.com/v2-fbdfb16d2e3329038aac1d4f5438a81a_720w.jpg?source=3af55fa1" data-caption="" data-size="normal" data-rawwidth="951" data-rawheight="292" class="origin_image zh-lightbox-thumb" width="951" data-original="https://pic3.zhimg.com/v2-fbdfb16d2e3329038aac1d4f5438a81a_r.jpg?source=3af55fa1"></noscript><img src="data:image/svg+xml;utf8,&lt;svg%20xmlns='http://www.w3.org/2000/svg'%20width='951'%20height='292'&gt;&lt;/svg&gt;" data-caption="" data-size="normal" data-rawwidth="951" data-rawheight="292" class="origin_image zh-lightbox-thumb lazy" width="951" data-original="https://pic3.zhimg.com/v2-fbdfb16d2e3329038aac1d4f5438a81a_r.jpg?source=3af55fa1" data-actualsrc="https://pic2.zhimg.com/v2-fbdfb16d2e3329038aac1d4f5438a81a_720w.jpg?source=3af55fa1"></figure><p data-pid="M1LGWFas">看了一下错误日志  </p><div class="highlight"><pre><code class="language-text"><span></span> Process: air.com.adobe.pstouch, PID: 14055
java.lang.UnsatisfiedLinkError: No implementation found for void com.adobe.air.AIRWindowSurfaceView.nativeSurfaceCreated() (tried Java_com_adobe_air_AIRWindowSurfaceView_nativeSurfaceCreated and Java_com_adobe_air_AIRWindowSurfaceView_nativeSurfaceCreated__)
	at com.adobe.air.AIRWindowSurfaceView.nativeSurfaceCreated(Native Method)
	at com.adobe.air.AIRWindowSurfaceView.surfaceCreated(AIRWindowSurfaceView.java:721)
	at android.view.SurfaceView.updateSurface(SurfaceView.java:670)
	at android.view.SurfaceView$2.onPreDraw(SurfaceView.java:143)
	at android.view.ViewTreeObserver.dispatchOnPreDraw(ViewTreeObserver.java:977)
	at android.view.ViewRootImpl.performTraversals(ViewRootImpl.java:2475)
	at android.view.ViewRootImpl.doTraversal(ViewRootImpl.java:1460)
	at android.view.ViewRootImpl$TraversalRunnable.run(ViewRootImpl.java:7184)
	at android.view.Choreographer$CallbackRecord.run(Choreographer.java:949)
	at android.view.Choreographer.doCallbacks(Choreographer.java:761)
	at android.view.Choreographer.doFrame(Choreographer.java:696)
	at android.view.Choreographer$FrameDisplayEventReceiver.run(Choreographer.java:935)
	at android.os.Handler.handleCallback(Handler.java:873)
	at android.os.Handler.dispatchMessage(Handler.java:99)
	at android.os.Looper.loop(Looper.java:193)
	at android.app.ActivityThread.main(ActivityThread.java:6669)
	at java.lang.reflect.Method.invoke(Native Method)
	at com.android.internal.os.RuntimeInit$MethodAndArgsCaller.run(RuntimeInit.java:493)
	at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:858)
</code></pre></div><p data-pid="Jyb8BJZh">问题集中在nativeSurfaceCreated这个方法上，看样子也是一个违规api调用，直接去dex里搜</p><p data-pid="HVt3gatb">然而...</p><figure data-size="normal"><noscript><img src="https://pic1.zhimg.com/v2-149ecac3f79fcc3335c0c72a8b5ba249_720w.jpg?source=3af55fa1" data-caption="" data-size="normal" data-rawwidth="898" data-rawheight="105" class="origin_image zh-lightbox-thumb" width="898" data-original="https://pica.zhimg.com/v2-149ecac3f79fcc3335c0c72a8b5ba249_r.jpg?source=3af55fa1"></noscript><img src="data:image/svg+xml;utf8,&lt;svg%20xmlns='http://www.w3.org/2000/svg'%20width='898'%20height='105'&gt;&lt;/svg&gt;" data-caption="" data-size="normal" data-rawwidth="898" data-rawheight="105" class="origin_image zh-lightbox-thumb lazy" width="898" data-original="https://pica.zhimg.com/v2-149ecac3f79fcc3335c0c72a8b5ba249_r.jpg?source=3af55fa1" data-actualsrc="https://pic1.zhimg.com/v2-149ecac3f79fcc3335c0c72a8b5ba249_720w.jpg?source=3af55fa1"></figure><p data-pid="Y89XKXqy">native方法，固化在so文件里，不可编辑。</p><p><br></p><p data-pid="mLKZK_dK">本以为没有办法了，突然想到ps touch是基于adobe air开发的，而琴梨梨前段时间基于adobe air移植了一个游戏，赶紧去试了试那个游戏能不能在9.0上打开</p><figure data-size="normal"><noscript><img src="https://pic1.zhimg.com/v2-6c5de85e8fda603f865b9b44a9c823d7_720w.jpg?source=3af55fa1" data-caption="" data-size="normal" data-rawwidth="1080" data-rawheight="1920" class="origin_image zh-lightbox-thumb" width="1080" data-original="https://pic2.zhimg.com/v2-6c5de85e8fda603f865b9b44a9c823d7_r.jpg?source=3af55fa1"></noscript><img src="data:image/svg+xml;utf8,&lt;svg%20xmlns='http://www.w3.org/2000/svg'%20width='1080'%20height='1920'&gt;&lt;/svg&gt;" data-caption="" data-size="normal" data-rawwidth="1080" data-rawheight="1920" class="origin_image zh-lightbox-thumb lazy" width="1080" data-original="https://pic2.zhimg.com/v2-6c5de85e8fda603f865b9b44a9c823d7_r.jpg?source=3af55fa1" data-actualsrc="https://pic1.zhimg.com/v2-6c5de85e8fda603f865b9b44a9c823d7_720w.jpg?source=3af55fa1"></figure><p data-pid="RFY1Wqlq">天无绝人之路，思路来了。</p><p data-pid="UocmfMVF">把这个能运行的air的so文件替换过去</p><figure data-size="normal"><noscript><img src="https://pica.zhimg.com/v2-7000b69b659ec784e7555459ea813a81_720w.jpg?source=3af55fa1" data-caption="" data-size="normal" data-rawwidth="1080" data-rawheight="1920" class="origin_image zh-lightbox-thumb" width="1080" data-original="https://pic4.zhimg.com/v2-7000b69b659ec784e7555459ea813a81_r.jpg?source=3af55fa1"></noscript><img src="data:image/svg+xml;utf8,&lt;svg%20xmlns='http://www.w3.org/2000/svg'%20width='1080'%20height='1920'&gt;&lt;/svg&gt;" data-caption="" data-size="normal" data-rawwidth="1080" data-rawheight="1920" class="origin_image zh-lightbox-thumb lazy" width="1080" data-original="https://pic4.zhimg.com/v2-7000b69b659ec784e7555459ea813a81_r.jpg?source=3af55fa1" data-actualsrc="https://pica.zhimg.com/v2-7000b69b659ec784e7555459ea813a81_720w.jpg?source=3af55fa1"></figure><p data-pid="6b-BWvc1">安装测试，还是闪退，但是抓log发现闪退的问题变了 </p><div class="highlight"><pre><code class="language-text"><span></span>LineageOS Version: '16.0-20181017_160230-UNOFFICIAL-natrium'
Build fingerprint: 'Xiaomi/natrium/natrium:7.0/NRD90M/V9.6.2.0.NBGMIFD:user/release-keys'
Revision: '0'
ABI: 'arm'
pid: 15955, tid: 15955, name: m.adobe.pstouch  &gt;&gt;&gt; air.com.adobe.pstouch &lt;&lt;&lt;
signal 6 (SIGABRT), code -6 (SI_TKILL), fault addr --------
Abort message: 'thread.cc:2148] No pending exception expected: java.lang.NoSuchMethodError: no static or non-static method "Lcom/adobe/air/AIRWindowSurfaceView;.nativeGetSoftKeyboardType()I"'
    r0  00000000  r1  00003e53  r2  00000006  r3  00000008
    r4  00003e53  r5  00003e53  r6  ffb092fc  r7  0000010c
    r8  00000002  r9  ffb09369  r10 0000000a  r11 ffb09368
    ip  ffb09298  sp  ffb092e8  lr  f51a9e89  pc  f51a1d2a
</code></pre></div><p data-pid="dh8_HKwH">这次的闪退问题是找不到method。推测因为这不是一个完全的native activity，在dex里也有对应的部分被更新了，需要同步过来。</p><p data-pid="XM6BopeJ">因为能正常运行的那个游戏的dex部分没有其他第三方库，就是air的基本组件，所以直接用快速patch法，把原dex改成2，把patch dex丢在前面，可以参考琴梨梨之前写的这篇文章</p><a href="http://link.zhihu.com/?target=https%3A//www.jianshu.com/p/cf63266cca86" data-draft-node="block" data-draft-type="link-card" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">https://www.</span><span class="visible">jianshu.com/p/cf63266cc</span><span class="invisible">a86</span><span class="ellipsis"></span></a><figure data-size="normal"><noscript><img src="https://pica.zhimg.com/v2-0faa5751ab78c5c78b1a81cf7b3431ac_720w.jpg?source=3af55fa1" data-caption="" data-size="normal" data-rawwidth="1079" data-rawheight="822" class="origin_image zh-lightbox-thumb" width="1079" data-original="https://pic3.zhimg.com/v2-0faa5751ab78c5c78b1a81cf7b3431ac_r.jpg?source=3af55fa1"></noscript><img src="data:image/svg+xml;utf8,&lt;svg%20xmlns='http://www.w3.org/2000/svg'%20width='1079'%20height='822'&gt;&lt;/svg&gt;" data-caption="" data-size="normal" data-rawwidth="1079" data-rawheight="822" class="origin_image zh-lightbox-thumb lazy" width="1079" data-original="https://pic3.zhimg.com/v2-0faa5751ab78c5c78b1a81cf7b3431ac_r.jpg?source=3af55fa1" data-actualsrc="https://pica.zhimg.com/v2-0faa5751ab78c5c78b1a81cf7b3431ac_720w.jpg?source=3af55fa1"></figure><p data-pid="ix4F0nHO">再次安装，这次可以运行了</p><figure data-size="normal"><noscript><img src="https://pic1.zhimg.com/v2-c208e08add3be22dc563f45dfb2cc440_720w.jpg?source=3af55fa1" data-caption="" data-size="normal" data-rawwidth="1920" data-rawheight="1080" class="origin_image zh-lightbox-thumb" width="1920" data-original="https://pic3.zhimg.com/v2-c208e08add3be22dc563f45dfb2cc440_r.jpg?source=3af55fa1"></noscript><img src="data:image/svg+xml;utf8,&lt;svg%20xmlns='http://www.w3.org/2000/svg'%20width='1920'%20height='1080'&gt;&lt;/svg&gt;" data-caption="" data-size="normal" data-rawwidth="1920" data-rawheight="1080" class="origin_image zh-lightbox-thumb lazy" width="1920" data-original="https://pic3.zhimg.com/v2-c208e08add3be22dc563f45dfb2cc440_r.jpg?source=3af55fa1" data-actualsrc="https://pic1.zhimg.com/v2-c208e08add3be22dc563f45dfb2cc440_720w.jpg?source=3af55fa1"></figure><p><br></p><p><br></p><p><br></p><p data-pid="eoiIOq4K">ps touch安装包可以在apk mirror下载，我就不把patch过的包放出来了，你们自己折腾玩吧</p>