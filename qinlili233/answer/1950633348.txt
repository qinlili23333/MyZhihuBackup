为什么有人认为没有独显直连的 ROG 游戏本都是智商检测本和智商税呢？
<p data-pid="f0YAVtzY">这次我必须反对一下 <a class="member_mention" href="http://www.zhihu.com/people/15412f9b39836b92d3d9d53de103444f" data-hash="15412f9b39836b92d3d9d53de103444f" data-hovercard="p$b$15412f9b39836b92d3d9d53de103444f">@墨鱼</a> </p><p data-pid="GtKmFL0m">独显非直连的瓶颈还是相当多的，不仅仅是帧率的问题</p><p><br></p><p data-pid="S7Cyulfb">以下问题均实际采集于我所使用的独显非直连机型:联想Y700,配置为6700HQ,16G,960M,4K60HZ</p><h2>问题0:核显的内存共享显存</h2><figure data-size="normal"><noscript><img src="https://pic2.zhimg.com/v2-2c30d8cccf6e8511ec9d8c0209f93046_720w.jpg?source=3af55fa1" data-rawwidth="1963" data-rawheight="1512" data-size="normal" data-caption="" data-default-watermark-src="https://pic1.zhimg.com/v2-a850fcbb8dddd0bd29d64c78ef3540be_720w.jpg?source=3af55fa1" class="origin_image zh-lightbox-thumb" width="1963" data-original="https://pic1.zhimg.com/v2-2c30d8cccf6e8511ec9d8c0209f93046_r.jpg?source=3af55fa1"></noscript><img src="data:image/svg+xml;utf8,&lt;svg%20xmlns='http://www.w3.org/2000/svg'%20width='1963'%20height='1512'&gt;&lt;/svg&gt;" data-rawwidth="1963" data-rawheight="1512" data-size="normal" data-caption="" data-default-watermark-src="https://pic1.zhimg.com/v2-a850fcbb8dddd0bd29d64c78ef3540be_720w.jpg?source=3af55fa1" class="origin_image zh-lightbox-thumb lazy" width="1963" data-original="https://pic1.zhimg.com/v2-2c30d8cccf6e8511ec9d8c0209f93046_r.jpg?source=3af55fa1" data-actualsrc="https://pic2.zhimg.com/v2-2c30d8cccf6e8511ec9d8c0209f93046_720w.jpg?source=3af55fa1"></figure><p data-pid="G00otUYA">我挂了一个4G的网心云,还有5.2G空闲内存对吧</p><p data-pid="NBo1T2kU">csgo只要4G空闲内存就能跑吧</p><p data-pid="PiOIKxeh">但我打不了csgo</p><p data-pid="rvz5apW0">因为牙膏厂的核显驱动在空闲内存小于4G时就有高概率直接干掉dwm,导致屏幕黑屏,必须用远程桌面救机</p><p data-pid="3_XCmIFs">这个问题甚至会导致chrome开多了页面后哪怕剩余内存还有3G左右chrome也会崩溃</p><h3>但在没有核显只有独显的台式机上,我从未复现过这个问题</h3><p data-pid="znKJ9dDK">结论:非独显直连需要预留额外的4G内存</p><h2>问题1:无边框/窗口帧率瓶颈</h2><p data-pid="mfrVaoTl">该问题复现需要以下前提:无边框全屏或窗口模式,非DX12/Vulkan(这俩api有dwm flip),较高的分辨率和/或刷新率(4K60,2K144级别,2K60尚未达到核显瓶颈)</p><figure data-size="normal"><noscript><img src="https://pic3.zhimg.com/v2-51ec3f81b670f2f98bfc5ed256703243_720w.jpg?source=3af55fa1" data-rawwidth="3840" data-rawheight="2160" data-size="normal" data-caption="" data-default-watermark-src="https://pic3.zhimg.com/v2-50df0b612d73a17d33a61756ec0230a0_720w.jpg?source=3af55fa1" class="origin_image zh-lightbox-thumb" width="3840" data-original="https://pic3.zhimg.com/v2-51ec3f81b670f2f98bfc5ed256703243_r.jpg?source=3af55fa1"></noscript><img src="data:image/svg+xml;utf8,&lt;svg%20xmlns='http://www.w3.org/2000/svg'%20width='3840'%20height='2160'&gt;&lt;/svg&gt;" data-rawwidth="3840" data-rawheight="2160" data-size="normal" data-caption="" data-default-watermark-src="https://pic3.zhimg.com/v2-50df0b612d73a17d33a61756ec0230a0_720w.jpg?source=3af55fa1" class="origin_image zh-lightbox-thumb lazy" width="3840" data-original="https://pic3.zhimg.com/v2-51ec3f81b670f2f98bfc5ed256703243_r.jpg?source=3af55fa1" data-actualsrc="https://pic3.zhimg.com/v2-51ec3f81b670f2f98bfc5ed256703243_720w.jpg?source=3af55fa1"></figure><p data-pid="Q3Pey8Rj">720p全低，独显这占用明显是在划水，为什么上不了60fps？非直连在捣鬼</p><p data-pid="SjnrSEs-">这个游戏只能无边框全屏（除非用我自己开发的工具强制独占全屏，独占全屏后960m轻松2k全高60），导致4k屏下即使渲染分辨率为720p，核显也需要做4k级别的copy</p><figure data-size="normal"><noscript><img src="https://pic1.zhimg.com/v2-2efd3e5a0042f08f712c906fe9d0d3f8_720w.jpg?source=3af55fa1" data-rawwidth="1958" data-rawheight="1519" data-size="normal" data-caption="" data-default-watermark-src="https://pica.zhimg.com/v2-beeafed1760c1b60da53daad56840635_720w.jpg?source=3af55fa1" class="origin_image zh-lightbox-thumb" width="1958" data-original="https://pic3.zhimg.com/v2-2efd3e5a0042f08f712c906fe9d0d3f8_r.jpg?source=3af55fa1"></noscript><img src="data:image/svg+xml;utf8,&lt;svg%20xmlns='http://www.w3.org/2000/svg'%20width='1958'%20height='1519'&gt;&lt;/svg&gt;" data-rawwidth="1958" data-rawheight="1519" data-size="normal" data-caption="" data-default-watermark-src="https://pica.zhimg.com/v2-beeafed1760c1b60da53daad56840635_720w.jpg?source=3af55fa1" class="origin_image zh-lightbox-thumb lazy" width="1958" data-original="https://pic3.zhimg.com/v2-2efd3e5a0042f08f712c906fe9d0d3f8_r.jpg?source=3af55fa1" data-actualsrc="https://pic1.zhimg.com/v2-2efd3e5a0042f08f712c906fe9d0d3f8_720w.jpg?source=3af55fa1"></figure><p data-pid="RywCX0iv">实测在核显copy负载大于40%的时候，就会限制帧率，哪怕独显此时还有114514%提升空间</p><h2>问题2：核显带来的延迟</h2><figure data-size="normal"><noscript><img src="https://pic2.zhimg.com/v2-66c7e7cb0a969f559e9ee2e7d36530ef_720w.jpg?source=3af55fa1" data-rawwidth="3840" data-rawheight="2160" data-size="normal" data-caption="" data-default-watermark-src="https://pic3.zhimg.com/v2-0f74edb5afa56753e7c872bd5afed698_720w.jpg?source=3af55fa1" class="origin_image zh-lightbox-thumb" width="3840" data-original="https://pic3.zhimg.com/v2-66c7e7cb0a969f559e9ee2e7d36530ef_r.jpg?source=3af55fa1"></noscript><img src="data:image/svg+xml;utf8,&lt;svg%20xmlns='http://www.w3.org/2000/svg'%20width='3840'%20height='2160'&gt;&lt;/svg&gt;" data-rawwidth="3840" data-rawheight="2160" data-size="normal" data-caption="" data-default-watermark-src="https://pic3.zhimg.com/v2-0f74edb5afa56753e7c872bd5afed698_720w.jpg?source=3af55fa1" class="origin_image zh-lightbox-thumb lazy" width="3840" data-original="https://pic3.zhimg.com/v2-66c7e7cb0a969f559e9ee2e7d36530ef_r.jpg?source=3af55fa1" data-actualsrc="https://pic2.zhimg.com/v2-66c7e7cb0a969f559e9ee2e7d36530ef_720w.jpg?source=3af55fa1"></figure><p data-pid="D-IeH-ro">我们使用PresentMon测量显示延迟，43fps下延迟为43.5ms，43*43.5=1870.5远大于1000，说明核显copy带来了极大的显示延迟（在独显直出设备上fps*延迟应该仅仅略大于1000）</p><p data-pid="O_oyYujl">为了做对比，我们把海王星放到核显上运行（核显直接渲染，没有copy消耗）</p><figure data-size="normal"><noscript><img src="https://pic2.zhimg.com/v2-01504fcdc767aa506bde1b3cc5c6142b_720w.jpg?source=3af55fa1" data-rawwidth="3463" data-rawheight="1893" data-size="normal" data-caption="" data-default-watermark-src="https://pic3.zhimg.com/v2-8207e7530c8dd8b3f609b603fb44bac9_720w.jpg?source=3af55fa1" class="origin_image zh-lightbox-thumb" width="3463" data-original="https://pic1.zhimg.com/v2-01504fcdc767aa506bde1b3cc5c6142b_r.jpg?source=3af55fa1"></noscript><img src="data:image/svg+xml;utf8,&lt;svg%20xmlns='http://www.w3.org/2000/svg'%20width='3463'%20height='1893'&gt;&lt;/svg&gt;" data-rawwidth="3463" data-rawheight="1893" data-size="normal" data-caption="" data-default-watermark-src="https://pic3.zhimg.com/v2-8207e7530c8dd8b3f609b603fb44bac9_720w.jpg?source=3af55fa1" class="origin_image zh-lightbox-thumb lazy" width="3463" data-original="https://pic1.zhimg.com/v2-01504fcdc767aa506bde1b3cc5c6142b_r.jpg?source=3af55fa1" data-actualsrc="https://pic2.zhimg.com/v2-01504fcdc767aa506bde1b3cc5c6142b_720w.jpg?source=3af55fa1"></figure><p data-pid="uGiuPNSg">(nt知乎1202年还不允许上传仅仅12m的小图片，不得不做了裁剪）</p><p data-pid="PY981Hb-">可以看到，因为没有核显copy，opengl游戏能成功进入flip而非dwm copy模式，不但帧率甚至比独显更高，延迟也有显著下降</p><p data-pid="MIoL1KTN">对于部分延迟不敏感的游戏，可能这点差距不算大。但如果你还是个音游壬，那么直接完蛋，因为核显的copy延迟是不稳定的，还不好校准，所以我从来没在我本子上打出过全p...台式上就很容易全p</p><h2>问题3：当前版本win10不允许非直连设备把dwm跑在独显上</h2><p data-pid="ThAKPL5q">光看这个问题，很正常，不然没法copy没画面了</p><p data-pid="27UUw0ug">问题是传统的GDI窗口全是dwm在渲染，包括开始菜单</p><h3>嗯，你们直连用户永远体会不到我们这些非直连开始菜单都他妈个比的掉帧是什么体验...</h3><p><br></p><p><br></p><h2>当然，不可否认，独显非直连也有一些特殊的优势，比如在使用虚拟机时可以把独显直接给passthrough，在跑opencl通算的时候可以独占独显，所以我认为mux切换是最佳形态</h2><h2>但没有独显直连，真挺坑的，这不是单单帧率上能反映出来的问题</h2><h2>这是我用了四年非直连本子得出来的血的教训，我吃了四年屎，我不想再吃哪怕一小口了</h2><p><br></p><hr><h2>在一些罕见情况下，也可能出现直出性能不如非支出的情况</h2><p data-pid="x34y70iX">这种情况必须满足：能吃满独显，但copy需求不高</p><p data-pid="BIAN37Po">比如离屏的影视特效渲染，因为非直出时独显没有dwm这口陈年老屎，所以表现可能反而好一些</p><h2>而mux切换可以同时拥有直出和非直出的优点</h2><p></p><p></p>
1624187637